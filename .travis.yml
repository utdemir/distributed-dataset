language: nix
sudo: required

env:
  - COMMAND="nix-build --argstr compiler ghc802"
  - COMMAND="nix-build --argstr compiler ghc822"
  - COMMAND="nix-build --argstr compiler ghc841"
  - COMMAND="nix-env -i stack && stack build"

script:
  - travis_wait 40 sleep 30m &
  - timeout 40m sh -c "$COMMAND"

before_install:
  - nix copy --all --no-check-sigs --from $HOME/nixcache

before_cache:
  - nix-store --verify --check-contents
  - nix copy --all --no-check-sigs --to $HOME/nixcache

cache:
  directories:
    - $HOME/nixcache
    - $HOME/.stack
  timeout: 10000
