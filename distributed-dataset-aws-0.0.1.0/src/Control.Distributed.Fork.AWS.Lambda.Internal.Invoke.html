<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Control.Distributed.Fork.AWS.Lambda.Internal.Invoke</span><span>
</span><span id="line-7"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#withInvoke"><span class="hs-identifier">withInvoke</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span class="hs-keyword">where</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/kdhpqqclg12pcmqzh5hc4ycqlvwqps6g-conduit-1.3.2-doc/share/doc/conduit-1.3.2/html/src"><span class="hs-identifier">Conduit</span></a></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/jx4y2sid3s6533m1kr8bjgv62vanjhjk-async-2.2.2-doc/share/doc/async-2.2.2/html/src"><span class="hs-identifier">Control.Concurrent.Async</span></a></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier">Control.Concurrent.MVar</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier">Control.Concurrent.Throttled</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Stack.html"><span class="hs-identifier">Control.Distributed.Fork.AWS.Lambda.Internal.Stack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Stack.html#StackInfo"><span class="hs-identifier">StackInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Types.html"><span class="hs-identifier">Control.Distributed.Fork.AWS.Lambda.Internal.Types</span></a></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier">Control.Distributed.Fork.Backend</span></a></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier">Control.Exception.Safe</span></a></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-identifier">Control.Lens</span></a></span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/6d7f942q5kyl0pk8fpd1qzhnxw2ly6g6-aeson-1.4.7.1-doc/share/doc/aeson-1.4.7.1/html/src"><span class="hs-identifier">Data.Aeson</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">A</span></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/fv2iz4n7mhzwgywqyvwfrsvpp0qds3cq-lens-aeson-1.1-doc/share/doc/lens-aeson-1.1/html/src"><span class="hs-identifier">Data.Aeson.Lens</span></a></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/bytestring-0.10.10.0/src"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BS</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/sccqc2kjwg3rfd7zc4ikf2y68pfv8sjp-base64-bytestring-1.0.0.3-doc/share/doc/base64-bytestring-1.0.0.3/html/src"><span class="hs-identifier">Data.ByteString.Base64</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B64</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/bytestring-0.10.10.0/src"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BL</span></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier">Data.Text</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier">Data.Text.Encoding</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier">Network.AWS</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/rqpiw4h1q711y0h2xbav6k1kg3sp3ji9-amazonka-lambda-1.6.1-doc/share/doc/amazonka-lambda-1.6.1/html/src"><span class="hs-identifier">Network.AWS.Lambda</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier">Network.AWS.S3</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S3</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier">Network.AWS.SQS</span></a></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-comment">{-
Since we're going to get our answers asynchronously, we maintain a state with
callbacks for individual invocations.

Every individual invocation have an incrementing id, so we can distinguish
the responses.
-}</span><span>
</span><span id="line-42"></span><span class="hs-keyword">data</span><span> </span><span id="LambdaState"><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaState"><span class="hs-identifier hs-var">LambdaState</span></a></span></span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="LambdaState"><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaState"><span class="hs-identifier hs-var">LambdaState</span></a></span></span><span>
</span><span id="line-44"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="lsInvocations"><span class="annot"><span class="annottext">LambdaState -&gt; Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#lsInvocations"><span class="hs-identifier hs-var hs-var">lsInvocations</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-type">M.Map</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Types.html#ResponsePayload"><span class="hs-identifier hs-type">ResponsePayload</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>        </span><span id="lsNextId"><span class="annot"><span class="annottext">LambdaState -&gt; Int
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#lsNextId"><span class="hs-identifier hs-var hs-var">lsNextId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-46"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">data</span><span> </span><span id="LambdaEnv"><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaEnv"><span class="hs-identifier hs-var">LambdaEnv</span></a></span></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="LambdaEnv"><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaEnv"><span class="hs-identifier hs-var">LambdaEnv</span></a></span></span><span>
</span><span id="line-50"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="leState"><span class="annot"><span class="annottext">LambdaEnv -&gt; MVar LambdaState
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#leState"><span class="hs-identifier hs-var hs-var">leState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaState"><span class="hs-identifier hs-type">LambdaState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>        </span><span id="leStack"><span class="annot"><span class="annottext">LambdaEnv -&gt; StackInfo
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#leStack"><span class="hs-identifier hs-var hs-var">leStack</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Stack.html#StackInfo"><span class="hs-identifier hs-type">StackInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>        </span><span id="leEnv"><span class="annot"><span class="annottext">LambdaEnv -&gt; Env
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#leEnv"><span class="hs-identifier hs-var hs-var">leEnv</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-type">Env</span></a></span><span>
</span><span id="line-53"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#newLambdaEnv"><span class="hs-identifier hs-type">newLambdaEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Stack.html#StackInfo"><span class="hs-identifier hs-type">StackInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaEnv"><span class="hs-identifier hs-type">LambdaEnv</span></a></span><span>
</span><span id="line-56"></span><span id="newLambdaEnv"><span class="annot"><span class="annottext">newLambdaEnv :: Env -&gt; StackInfo -&gt; IO LambdaEnv
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#newLambdaEnv"><span class="hs-identifier hs-var hs-var">newLambdaEnv</span></a></span></span><span> </span><span id="local-6989586621679255744"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679255744"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679255743"><span class="annot"><span class="annottext">StackInfo
</span><a href="#local-6989586621679255743"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><span class="annottext">MVar LambdaState -&gt; StackInfo -&gt; Env -&gt; LambdaEnv
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaEnv"><span class="hs-identifier hs-var">LambdaEnv</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="annot"><span class="annottext">(MVar LambdaState -&gt; StackInfo -&gt; Env -&gt; LambdaEnv)
-&gt; IO (MVar LambdaState) -&gt; IO (StackInfo -&gt; Env -&gt; LambdaEnv)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaState -&gt; IO (MVar LambdaState)
forall a. a -&gt; IO (MVar a)
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">newMVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map Int (IO ResponsePayload -&gt; IO ()) -&gt; Int -&gt; LambdaState
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaState"><span class="hs-identifier hs-var">LambdaState</span></a></span><span> </span><span class="annot"><span class="annottext">Map Int (IO ResponsePayload -&gt; IO ())
forall k a. Map k a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">M.empty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><span class="annottext">IO (StackInfo -&gt; Env -&gt; LambdaEnv)
-&gt; IO StackInfo -&gt; IO (Env -&gt; LambdaEnv)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">StackInfo -&gt; IO StackInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">StackInfo
</span><a href="#local-6989586621679255743"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="annottext">IO (Env -&gt; LambdaEnv) -&gt; IO Env -&gt; IO LambdaEnv
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; IO Env
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679255744"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="hs-comment">{-
When invoking a function, we insert a new id to the state and then call Lambda.
-}</span><span>
</span><span id="line-65"></span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#execute"><span class="hs-identifier hs-type">execute</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaEnv"><span class="hs-identifier hs-type">LambdaEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-type">Throttle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-type">Throttle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-type">Throttle</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/bytestring-0.10.10.0/src"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-type">BackendM</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/bytestring-0.10.10.0/src"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span>
</span><span id="line-70"></span><span id="execute"><span class="annot"><span class="annottext">execute :: LambdaEnv
-&gt; (Throttle, Throttle, Throttle)
-&gt; ByteString
-&gt; BackendM ByteString
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#execute"><span class="hs-identifier hs-var hs-var">execute</span></a></span></span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaEnv"><span class="hs-identifier hs-type">LambdaEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679255736"><span id="local-6989586621679255737"><span id="local-6989586621679255738"><span class="annot"><span class="annottext">Env
MVar LambdaState
StackInfo
leEnv :: Env
leStack :: StackInfo
leState :: MVar LambdaState
leEnv :: LambdaEnv -&gt; Env
leStack :: LambdaEnv -&gt; StackInfo
leState :: LambdaEnv -&gt; MVar LambdaState
</span><a href="#local-6989586621679255736"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679255735"><span class="annot"><span class="annottext">Throttle
</span><a href="#local-6989586621679255735"><span class="hs-identifier hs-var">invocationThrottle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679255734"><span class="annot"><span class="annottext">Throttle
</span><a href="#local-6989586621679255734"><span class="hs-identifier hs-var">executionThrottle</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679255733"><span class="annot"><span class="annottext">Throttle
</span><a href="#local-6989586621679255733"><span class="hs-identifier hs-var">downloadThrottle</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679255732"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679255732"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-comment">-- Modify environment</span><span>
</span><span id="line-72"></span><span>  </span><span id="local-6989586621679255731"><span class="annot"><span class="annottext">MVar (IO ResponsePayload)
</span><a href="#local-6989586621679255731"><span class="hs-identifier hs-var">mvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar (IO ResponsePayload))
-&gt; BackendM (MVar (IO ResponsePayload))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (MVar (IO ResponsePayload))
 -&gt; BackendM (MVar (IO ResponsePayload)))
-&gt; IO (MVar (IO ResponsePayload))
-&gt; BackendM (MVar (IO ResponsePayload))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO (MVar (IO ResponsePayload))
forall a. IO (MVar a)
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">newEmptyMVar</span></a></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Types.html#ResponsePayload"><span class="hs-identifier hs-type">ResponsePayload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>  </span><span id="local-6989586621679255728"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679255728"><span class="hs-identifier hs-var">id'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="annottext">IO Int -&gt; BackendM Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; BackendM Int) -&gt; IO Int -&gt; BackendM Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MVar LambdaState
-&gt; (LambdaState -&gt; IO (LambdaState, Int)) -&gt; IO Int
forall a b. MVar a -&gt; (a -&gt; IO (a, b)) -&gt; IO b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">modifyMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar LambdaState
</span><a href="#local-6989586621679255738"><span class="hs-identifier hs-var">leState</span></a></span><span> </span><span class="annot"><span class="annottext">((LambdaState -&gt; IO (LambdaState, Int)) -&gt; IO Int)
-&gt; (LambdaState -&gt; IO (LambdaState, Int)) -&gt; IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaState"><span class="hs-identifier hs-type">LambdaState</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679255725"><span id="local-6989586621679255726"><span class="annot"><span class="annottext">Int
Map Int (IO ResponsePayload -&gt; IO ())
lsNextId :: Int
lsInvocations :: Map Int (IO ResponsePayload -&gt; IO ())
lsNextId :: LambdaState -&gt; Int
lsInvocations :: LambdaState -&gt; Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="#local-6989586621679255725"><span class="hs-glyph hs-var hs-var hs-var hs-var">..</span></a></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-75"></span><span>      </span><span class="annot"><span class="annottext">(LambdaState, Int) -&gt; IO (LambdaState, Int)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-76"></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">LambdaState :: Map Int (IO ResponsePayload -&gt; IO ()) -&gt; Int -&gt; LambdaState
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaState"><span class="hs-identifier hs-type">LambdaState</span></a></span><span>
</span><span id="line-77"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lsNextId :: Int
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#lsNextId"><span class="hs-identifier hs-var">lsNextId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679255725"><span class="hs-identifier hs-var">lsNextId</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>              </span><span class="annot"><span class="annottext">lsInvocations :: Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#lsInvocations"><span class="hs-identifier hs-var">lsInvocations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; (IO ResponsePayload -&gt; IO ())
-&gt; Map Int (IO ResponsePayload -&gt; IO ())
-&gt; Map Int (IO ResponsePayload -&gt; IO ())
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">M.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679255725"><span class="hs-identifier hs-var">lsNextId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO Bool -&gt; IO ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; IO ())
-&gt; (IO ResponsePayload -&gt; IO Bool) -&gt; IO ResponsePayload -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (IO ResponsePayload) -&gt; IO ResponsePayload -&gt; IO Bool
forall a. MVar a -&gt; a -&gt; IO Bool
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">tryPutMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (IO ResponsePayload)
</span><a href="#local-6989586621679255731"><span class="hs-identifier hs-var">mvar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="#local-6989586621679255726"><span class="hs-identifier hs-var">lsInvocations</span></a></span><span>
</span><span id="line-79"></span><span>            </span><span class="hs-special">}</span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679255725"><span class="hs-identifier hs-var">lsNextId</span></a></span><span>
</span><span id="line-81"></span><span>        </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>  </span><span id="local-6989586621679255719"><span class="annot"><span class="annottext">ResponsePayload
</span><a href="#local-6989586621679255719"><span class="hs-identifier hs-var">answer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><span class="annottext">Throttle
-&gt; forall (m :: * -&gt; *) a. (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
</span><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-var hs-var">throttled</span></a></span><span> </span><span class="annot"><span class="annottext">Throttle
</span><a href="#local-6989586621679255734"><span class="hs-identifier hs-var">executionThrottle</span></a></span><span> </span><span class="annot"><span class="annottext">(BackendM ResponsePayload -&gt; BackendM ResponsePayload)
-&gt; BackendM ResponsePayload -&gt; BackendM ResponsePayload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-84"></span><span>      </span><span class="hs-comment">-- invoke the lambda function</span><span>
</span><span id="line-85"></span><span>      </span><span id="local-6989586621679255717"><span class="annot"><span class="annottext">InvokeResponse
</span><a href="#local-6989586621679255717"><span class="hs-identifier hs-var">irs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><span class="annottext">Throttle
-&gt; forall (m :: * -&gt; *) a. (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
</span><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-var hs-var">throttled</span></a></span><span> </span><span class="annot"><span class="annottext">Throttle
</span><a href="#local-6989586621679255735"><span class="hs-identifier hs-var">invocationThrottle</span></a></span><span> </span><span class="annot"><span class="annottext">(BackendM InvokeResponse -&gt; BackendM InvokeResponse)
-&gt; BackendM InvokeResponse -&gt; BackendM InvokeResponse
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT BackendM InvokeResponse -&gt; BackendM InvokeResponse
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../file:///nix/store/x49rz651v9cgnj874d6smacv0b5w45bn-resourcet-1.2.4-doc/share/doc/resourcet-1.2.4/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT BackendM InvokeResponse -&gt; BackendM InvokeResponse)
-&gt; (AWS InvokeResponse -&gt; ResourceT BackendM InvokeResponse)
-&gt; AWS InvokeResponse
-&gt; BackendM InvokeResponse
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; AWS InvokeResponse -&gt; ResourceT BackendM InvokeResponse
forall (m :: * -&gt; *) r a.
(MonadResource m, HasEnv r) =&gt;
r -&gt; AWS a -&gt; m a
</span><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-var">runAWS</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679255736"><span class="hs-identifier hs-var">leEnv</span></a></span><span>
</span><span id="line-87"></span><span>          </span><span class="annot"><span class="annottext">(AWS InvokeResponse -&gt; BackendM InvokeResponse)
-&gt; AWS InvokeResponse -&gt; BackendM InvokeResponse
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Invoke -&gt; AWST' Env (ResourceT IO) (Rs Invoke)
forall (m :: * -&gt; *) a. (MonadAWS m, AWSRequest a) =&gt; a -&gt; m (Rs a)
</span><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-var">send</span></a></span><span>
</span><span id="line-88"></span><span>          </span><span class="annot"><span class="annottext">(Invoke -&gt; AWST' Env (ResourceT IO) (Rs Invoke))
-&gt; Invoke -&gt; AWST' Env (ResourceT IO) (Rs Invoke)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString -&gt; Invoke
</span><a href="../file:///nix/store/rqpiw4h1q711y0h2xbav6k1kg3sp3ji9-amazonka-lambda-1.6.1-doc/share/doc/amazonka-lambda-1.6.1/html/src"><span class="hs-identifier hs-var">invoke</span></a></span><span>
</span><span id="line-89"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StackInfo -&gt; Text
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Stack.html#siFunc"><span class="hs-identifier hs-var hs-var">siFunc</span></a></span><span> </span><span class="annot"><span class="annottext">StackInfo
</span><a href="#local-6989586621679255737"><span class="hs-identifier hs-var">leStack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>            </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/bytestring-0.10.10.0/src"><span class="hs-identifier hs-var">BL.toStrict</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; ByteString)
-&gt; (Value -&gt; ByteString) -&gt; Value -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ByteString
forall a. ToJSON a =&gt; a -&gt; ByteString
</span><a href="../file:///nix/store/6d7f942q5kyl0pk8fpd1qzhnxw2ly6g6-aeson-1.4.7.1-doc/share/doc/aeson-1.4.7.1/html/src"><span class="hs-identifier hs-var">A.encode</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ByteString) -&gt; Value -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-91"></span><span>                </span><span class="annot"><span class="annottext">[Pair] -&gt; Value
</span><a href="../file:///nix/store/6d7f942q5kyl0pk8fpd1qzhnxw2ly6g6-aeson-1.4.7.1-doc/share/doc/aeson-1.4.7.1/html/src"><span class="hs-identifier hs-var">A.object</span></a></span><span>
</span><span id="line-92"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;d&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../file:///nix/store/6d7f942q5kyl0pk8fpd1qzhnxw2ly6g6-aeson-1.4.7.1-doc/share/doc/aeson-1.4.7.1/html/src"><span class="hs-identifier hs-var">A.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Value) -&gt; (ByteString -&gt; Text) -&gt; ByteString -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.decodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Value) -&gt; ByteString -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../file:///nix/store/sccqc2kjwg3rfd7zc4ikf2y68pfv8sjp-base64-bytestring-1.0.0.3-doc/share/doc/base64-bytestring-1.0.0.3/html/src"><span class="hs-identifier hs-var">B64.encode</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679255732"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;i&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><a href="../file:///nix/store/6d7f942q5kyl0pk8fpd1qzhnxw2ly6g6-aeson-1.4.7.1-doc/share/doc/aeson-1.4.7.1/html/src"><span class="hs-identifier hs-var">A.toJSON</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679255728"><span class="hs-identifier hs-var">id'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-95"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span>            </span><span class="annot"><span class="annottext">Invoke -&gt; (Invoke -&gt; Invoke) -&gt; Invoke
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe InvocationType -&gt; Identity (Maybe InvocationType))
-&gt; Invoke -&gt; Identity Invoke
Lens' Invoke (Maybe InvocationType)
</span><a href="../file:///nix/store/rqpiw4h1q711y0h2xbav6k1kg3sp3ji9-amazonka-lambda-1.6.1-doc/share/doc/amazonka-lambda-1.6.1/html/src"><span class="hs-identifier hs-var">iInvocationType</span></a></span><span>
</span><span id="line-97"></span><span>            </span><span class="annot"><span class="annottext">((Maybe InvocationType -&gt; Identity (Maybe InvocationType))
 -&gt; Invoke -&gt; Identity Invoke)
-&gt; InvocationType -&gt; Invoke -&gt; Invoke
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">?~</span></a></span><span> </span><span class="annot"><span class="annottext">InvocationType
</span><a href="../file:///nix/store/rqpiw4h1q711y0h2xbav6k1kg3sp3ji9-amazonka-lambda-1.6.1-doc/share/doc/amazonka-lambda-1.6.1/html/src"><span class="hs-identifier hs-var">Event</span></a></span><span>
</span><span id="line-98"></span><span>      </span><span class="annot"><span class="annottext">BackendM ()
</span><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-var">submitted</span></a></span><span>
</span><span id="line-99"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; BackendM () -&gt; BackendM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvokeResponse
</span><a href="#local-6989586621679255717"><span class="hs-identifier hs-var">irs</span></a></span><span> </span><span class="annot"><span class="annottext">InvokeResponse -&gt; Getting Int InvokeResponse Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Int InvokeResponse Int
Lens' InvokeResponse Int
</span><a href="../file:///nix/store/rqpiw4h1q711y0h2xbav6k1kg3sp3ji9-amazonka-lambda-1.6.1-doc/share/doc/amazonka-lambda-1.6.1/html/src"><span class="hs-identifier hs-var">irsStatusCode</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>        </span><span class="annot"><span class="annottext">(BackendM () -&gt; BackendM ()) -&gt; BackendM () -&gt; BackendM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InvokeException -&gt; BackendM ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(InvokeException -&gt; BackendM ())
-&gt; (Text -&gt; InvokeException) -&gt; Text -&gt; BackendM ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InvokeException
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><span class="annottext">(Text -&gt; BackendM ()) -&gt; Text -&gt; BackendM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Invoke failed. Status code: &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; String) -&gt; Int -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InvokeResponse
</span><a href="#local-6989586621679255717"><span class="hs-identifier hs-var">irs</span></a></span><span> </span><span class="annot"><span class="annottext">InvokeResponse -&gt; Getting Int InvokeResponse Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Int InvokeResponse Int
Lens' InvokeResponse Int
</span><a href="../file:///nix/store/rqpiw4h1q711y0h2xbav6k1kg3sp3ji9-amazonka-lambda-1.6.1-doc/share/doc/amazonka-lambda-1.6.1/html/src"><span class="hs-identifier hs-var">irsStatusCode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>      </span><span class="hs-comment">-- wait fo the answer</span><span>
</span><span id="line-103"></span><span>      </span><span class="annot"><span class="annottext">IO ResponsePayload -&gt; BackendM ResponsePayload
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ResponsePayload -&gt; BackendM ResponsePayload)
-&gt; (IO (IO ResponsePayload) -&gt; IO ResponsePayload)
-&gt; IO (IO ResponsePayload)
-&gt; BackendM ResponsePayload
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO (IO ResponsePayload) -&gt; IO ResponsePayload
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IO ResponsePayload) -&gt; BackendM ResponsePayload)
-&gt; IO (IO ResponsePayload) -&gt; BackendM ResponsePayload
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (IO ResponsePayload) -&gt; IO (IO ResponsePayload)
forall a. MVar a -&gt; IO a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">readMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar (IO ResponsePayload)
</span><a href="#local-6989586621679255731"><span class="hs-identifier hs-var">mvar</span></a></span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ResponsePayload
</span><a href="#local-6989586621679255719"><span class="hs-identifier hs-var">answer</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Types.html#ResponsePayloadInline"><span class="hs-identifier hs-type">ResponsePayloadInline</span></a></span><span> </span><span id="local-6989586621679255690"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679255690"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Either String ByteString
</span><a href="../file:///nix/store/sccqc2kjwg3rfd7zc4ikf2y68pfv8sjp-base64-bytestring-1.0.0.3-doc/share/doc/base64-bytestring-1.0.0.3/html/src"><span class="hs-identifier hs-var">B64.decode</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Either String ByteString)
-&gt; (Text -&gt; ByteString) -&gt; Text -&gt; Either String ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Either String ByteString)
-&gt; Text -&gt; Either String ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679255690"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679255687"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679255687"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-108"></span><span>          </span><span class="annot"><span class="annottext">InvokeException -&gt; BackendM ByteString
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(InvokeException -&gt; BackendM ByteString)
-&gt; (Text -&gt; InvokeException) -&gt; Text -&gt; BackendM ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InvokeException
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; BackendM ByteString) -&gt; Text -&gt; BackendM ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-109"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error decoding answer: &quot;</span></span><span>
</span><span id="line-110"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679255687"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-111"></span><span>        </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679255686"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679255686"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; BackendM ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679255686"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Types.html#ResponsePayloadS3"><span class="hs-identifier hs-type">ResponsePayloadS3</span></a></span><span> </span><span id="local-6989586621679255684"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679255684"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-113"></span><span>      </span><span class="annot"><span class="annottext">Throttle
-&gt; forall (m :: * -&gt; *) a. (MonadIO m, MonadMask m) =&gt; m a -&gt; m a
</span><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-var hs-var">throttled</span></a></span><span> </span><span class="annot"><span class="annottext">Throttle
</span><a href="#local-6989586621679255733"><span class="hs-identifier hs-var">downloadThrottle</span></a></span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">(BackendM ByteString -&gt; BackendM ByteString)
-&gt; BackendM ByteString -&gt; BackendM ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ResourceT BackendM ByteString -&gt; BackendM ByteString
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../file:///nix/store/x49rz651v9cgnj874d6smacv0b5w45bn-resourcet-1.2.4-doc/share/doc/resourcet-1.2.4/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span>
</span><span id="line-115"></span><span>          </span><span class="annot"><span class="annottext">(ResourceT BackendM ByteString -&gt; BackendM ByteString)
-&gt; (AWS ByteString -&gt; ResourceT BackendM ByteString)
-&gt; AWS ByteString
-&gt; BackendM ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; AWS ByteString -&gt; ResourceT BackendM ByteString
forall (m :: * -&gt; *) r a.
(MonadResource m, HasEnv r) =&gt;
r -&gt; AWS a -&gt; m a
</span><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-var">runAWS</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679255736"><span class="hs-identifier hs-var">leEnv</span></a></span><span>
</span><span id="line-116"></span><span>        </span><span class="annot"><span class="annottext">(AWS ByteString -&gt; BackendM ByteString)
-&gt; AWS ByteString -&gt; BackendM ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-117"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679255683"><span class="annot"><span class="annottext">bucketName :: BucketName
</span><a href="#local-6989586621679255683"><span class="hs-identifier hs-var hs-var">bucketName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; BucketName
</span><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier hs-var">S3.BucketName</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; BucketName) -&gt; Text -&gt; BucketName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">StackInfo -&gt; Text
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Stack.html#siAnswerBucket"><span class="hs-identifier hs-var hs-var">siAnswerBucket</span></a></span><span> </span><span class="annot"><span class="annottext">StackInfo
</span><a href="#local-6989586621679255737"><span class="hs-identifier hs-var">leStack</span></a></span><span>
</span><span id="line-118"></span><span>          </span><span id="local-6989586621679255680"><span class="annot"><span class="annottext">GetObjectResponse
</span><a href="#local-6989586621679255680"><span class="hs-identifier hs-var">gors</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GetObject -&gt; AWST' Env (ResourceT IO) (Rs GetObject)
forall (m :: * -&gt; *) a. (MonadAWS m, AWSRequest a) =&gt; a -&gt; m (Rs a)
</span><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">(GetObject -&gt; AWST' Env (ResourceT IO) (Rs GetObject))
-&gt; GetObject -&gt; AWST' Env (ResourceT IO) (Rs GetObject)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BucketName -&gt; ObjectKey -&gt; GetObject
</span><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier hs-var">getObject</span></a></span><span> </span><span class="annot"><span class="annottext">BucketName
</span><a href="#local-6989586621679255683"><span class="hs-identifier hs-var">bucketName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ObjectKey
</span><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier hs-var">ObjectKey</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679255684"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetObjectResponse
</span><a href="#local-6989586621679255680"><span class="hs-identifier hs-var">gors</span></a></span><span> </span><span class="annot"><span class="annottext">GetObjectResponse -&gt; Getting Int GetObjectResponse Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Int GetObjectResponse Int
Lens' GetObjectResponse Int
</span><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier hs-var">gorsResponseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>            </span><span class="annot"><span class="annottext">(AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InvokeException -&gt; AWST' Env (ResourceT IO) ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span>
</span><span id="line-121"></span><span>              </span><span class="annot"><span class="annottext">(InvokeException -&gt; AWST' Env (ResourceT IO) ())
-&gt; (Text -&gt; InvokeException) -&gt; Text -&gt; AWST' Env (ResourceT IO) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InvokeException
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span><span>
</span><span id="line-122"></span><span>            </span><span class="annot"><span class="annottext">(Text -&gt; AWST' Env (ResourceT IO) ())
-&gt; Text -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Downloading result failed. Status code: &quot;</span></span><span>
</span><span id="line-123"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; String) -&gt; Int -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GetObjectResponse
</span><a href="#local-6989586621679255680"><span class="hs-identifier hs-var">gors</span></a></span><span> </span><span class="annot"><span class="annottext">GetObjectResponse -&gt; Getting Int GetObjectResponse Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Int GetObjectResponse Int
Lens' GetObjectResponse Int
</span><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier hs-var">gorsResponseStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>          </span><span id="local-6989586621679255676"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679255676"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ByteString] -&gt; ByteString
forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString)
-&gt; AWST' Env (ResourceT IO) [ByteString] -&gt; AWS ByteString
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RsBody
-&gt; ConduitM ByteString Void (ResourceT IO) [ByteString]
-&gt; AWST' Env (ResourceT IO) [ByteString]
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
RsBody -&gt; ConduitM ByteString Void (ResourceT IO) a -&gt; m a
</span><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-var">sinkBody</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GetObjectResponse
</span><a href="#local-6989586621679255680"><span class="hs-identifier hs-var">gors</span></a></span><span> </span><span class="annot"><span class="annottext">GetObjectResponse
-&gt; Getting RsBody GetObjectResponse RsBody -&gt; RsBody
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting RsBody GetObjectResponse RsBody
Lens' GetObjectResponse RsBody
</span><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier hs-var">gorsBody</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConduitM ByteString Void (ResourceT IO) [ByteString]
forall (m :: * -&gt; *) a o. Monad m =&gt; ConduitT a o m [a]
</span><a href="../file:///nix/store/kdhpqqclg12pcmqzh5hc4ycqlvwqps6g-conduit-1.3.2-doc/share/doc/conduit-1.3.2/html/src"><span class="hs-identifier hs-var">sinkList</span></a></span><span>
</span><span id="line-125"></span><span>          </span><span id="local-6989586621679255672"><span class="annot"><span class="annottext">DeleteObjectResponse
</span><a href="#local-6989586621679255672"><span class="hs-identifier hs-var">dors</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DeleteObject -&gt; AWST' Env (ResourceT IO) (Rs DeleteObject)
forall (m :: * -&gt; *) a. (MonadAWS m, AWSRequest a) =&gt; a -&gt; m (Rs a)
</span><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">(DeleteObject -&gt; AWST' Env (ResourceT IO) (Rs DeleteObject))
-&gt; DeleteObject -&gt; AWST' Env (ResourceT IO) (Rs DeleteObject)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">BucketName -&gt; ObjectKey -&gt; DeleteObject
</span><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier hs-var">deleteObject</span></a></span><span> </span><span class="annot"><span class="annottext">BucketName
</span><a href="#local-6989586621679255683"><span class="hs-identifier hs-var">bucketName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ObjectKey
</span><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier hs-var">ObjectKey</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679255684"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeleteObjectResponse
</span><a href="#local-6989586621679255672"><span class="hs-identifier hs-var">dors</span></a></span><span> </span><span class="annot"><span class="annottext">DeleteObjectResponse -&gt; Getting Int DeleteObjectResponse Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Int DeleteObjectResponse Int
Lens' DeleteObjectResponse Int
</span><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier hs-var">dorsResponseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>            </span><span class="annot"><span class="annottext">(AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">InvokeException -&gt; AWST' Env (ResourceT IO) ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span>
</span><span id="line-128"></span><span>              </span><span class="annot"><span class="annottext">(InvokeException -&gt; AWST' Env (ResourceT IO) ())
-&gt; (Text -&gt; InvokeException) -&gt; Text -&gt; AWST' Env (ResourceT IO) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InvokeException
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span><span>
</span><span id="line-129"></span><span>            </span><span class="annot"><span class="annottext">(Text -&gt; AWST' Env (ResourceT IO) ())
-&gt; Text -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Deleting result failed. Status code: &quot;</span></span><span>
</span><span id="line-130"></span><span>              </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; String) -&gt; Int -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DeleteObjectResponse
</span><a href="#local-6989586621679255672"><span class="hs-identifier hs-var">dors</span></a></span><span> </span><span class="annot"><span class="annottext">DeleteObjectResponse -&gt; Getting Int DeleteObjectResponse Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Int DeleteObjectResponse Int
Lens' DeleteObjectResponse Int
</span><a href="../file:///nix/store/mc36vaqz480b285nm0yf3an90mv4jz5j-amazonka-s3-1.6.1-doc/share/doc/amazonka-s3-1.6.1/html/src"><span class="hs-identifier hs-var">dorsResponseStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span>          </span><span class="annot"><span class="annottext">ByteString -&gt; AWS ByteString
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679255676"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span class="hs-comment">{-
And then we listen from answerQueue for the responses
-}</span><span>
</span><span id="line-136"></span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#answerThread"><span class="hs-identifier hs-type">answerThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaEnv"><span class="hs-identifier hs-type">LambdaEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span id="answerThread"><span class="annot"><span class="annottext">answerThread :: LambdaEnv -&gt; IO ()
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#answerThread"><span class="hs-identifier hs-var hs-var">answerThread</span></a></span></span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaEnv"><span class="hs-identifier hs-type">LambdaEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679255666"><span id="local-6989586621679255667"><span id="local-6989586621679255668"><span class="annot"><span class="annottext">Env
MVar LambdaState
StackInfo
leEnv :: Env
leStack :: StackInfo
leState :: MVar LambdaState
leEnv :: LambdaEnv -&gt; Env
leStack :: LambdaEnv -&gt; StackInfo
leState :: LambdaEnv -&gt; MVar LambdaState
</span><a href="#local-6989586621679255666"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../file:///nix/store/x49rz651v9cgnj874d6smacv0b5w45bn-resourcet-1.2.4-doc/share/doc/resourcet-1.2.4/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ())
-&gt; (AWST' Env (ResourceT IO) () -&gt; ResourceT IO ())
-&gt; AWST' Env (ResourceT IO) ()
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; AWST' Env (ResourceT IO) () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) r a.
(MonadResource m, HasEnv r) =&gt;
r -&gt; AWS a -&gt; m a
</span><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-var">runAWS</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679255666"><span class="hs-identifier hs-var">leEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(AWST' Env (ResourceT IO) () -&gt; ResourceT IO ())
-&gt; (AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) ()
-&gt; ResourceT IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(AWST' Env (ResourceT IO) () -&gt; IO ())
-&gt; AWST' Env (ResourceT IO) () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-139"></span><span>    </span><span id="local-6989586621679255664"><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679255664"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AWS [Message]
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#sqsReceiveSome"><span class="hs-identifier hs-var">sqsReceiveSome</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; AWS [Message]) -&gt; Text -&gt; AWS [Message]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">StackInfo -&gt; Text
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Stack.html#siAnswerQueue"><span class="hs-identifier hs-var hs-var">siAnswerQueue</span></a></span><span> </span><span class="annot"><span class="annottext">StackInfo
</span><a href="#local-6989586621679255667"><span class="hs-identifier hs-var">leStack</span></a></span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><span class="annottext">[Message]
-&gt; (Message -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679255664"><span class="hs-identifier hs-var">msgs</span></a></span><span> </span><span class="annot"><span class="annottext">((Message -&gt; AWST' Env (ResourceT IO) ())
 -&gt; AWST' Env (ResourceT IO) ())
-&gt; (Message -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679255660"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255660"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>      </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Types.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span id="local-6989586621679255658"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679255658"><span class="hs-identifier hs-var">id'</span></a></span></span><span> </span><span id="local-6989586621679255657"><span class="annot"><span class="annottext">ResponsePayload
</span><a href="#local-6989586621679255657"><span class="hs-identifier hs-var">payload</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe Response
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><a href="../file:///nix/store/6d7f942q5kyl0pk8fpd1qzhnxw2ly6g6-aeson-1.4.7.1-doc/share/doc/aeson-1.4.7.1/html/src"><span class="hs-identifier hs-var">A.decodeStrict</span></a></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe Response)
-&gt; (Text -&gt; ByteString) -&gt; Text -&gt; Maybe Response
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.encodeUtf8</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Maybe Response) -&gt; Maybe Text -&gt; Maybe (Maybe Response)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255660"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Message -&gt; Getting (Maybe Text) Message (Maybe Text) -&gt; Maybe Text
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe Text) Message (Maybe Text)
Lens' Message (Maybe Text)
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">mBody</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-143"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Maybe Response)
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-144"></span><span>            </span><span class="annot"><span class="annottext">InvokeException -&gt; AWST' Env (ResourceT IO) Response
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(InvokeException -&gt; AWST' Env (ResourceT IO) Response)
-&gt; (Text -&gt; InvokeException)
-&gt; Text
-&gt; AWST' Env (ResourceT IO) Response
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InvokeException
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; AWST' Env (ResourceT IO) Response)
-&gt; Text -&gt; AWST' Env (ResourceT IO) Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-145"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error decoding answer: no body.&quot;</span></span><span>
</span><span id="line-146"></span><span>          </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Response
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>            </span><span class="annot"><span class="annottext">InvokeException -&gt; AWST' Env (ResourceT IO) Response
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(InvokeException -&gt; AWST' Env (ResourceT IO) Response)
-&gt; (Text -&gt; InvokeException)
-&gt; Text
-&gt; AWST' Env (ResourceT IO) Response
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InvokeException
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; AWST' Env (ResourceT IO) Response)
-&gt; Text -&gt; AWST' Env (ResourceT IO) Response
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-148"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error decoding answer: invalid json: &quot;</span></span><span>
</span><span id="line-149"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255660"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>          </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679255654"><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679255654"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Response -&gt; AWST' Env (ResourceT IO) Response
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Response
</span><a href="#local-6989586621679255654"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-151"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; AWST' Env (ResourceT IO) ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; AWST' Env (ResourceT IO) ())
-&gt; ((LambdaState -&gt; IO LambdaState) -&gt; IO ())
-&gt; (LambdaState -&gt; IO LambdaState)
-&gt; AWST' Env (ResourceT IO) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">MVar LambdaState -&gt; (LambdaState -&gt; IO LambdaState) -&gt; IO ()
forall a. MVar a -&gt; (a -&gt; IO a) -&gt; IO ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">modifyMVar_</span></a></span><span> </span><span class="annot"><span class="annottext">MVar LambdaState
</span><a href="#local-6989586621679255668"><span class="hs-identifier hs-var">leState</span></a></span><span> </span><span class="annot"><span class="annottext">((LambdaState -&gt; IO LambdaState) -&gt; AWST' Env (ResourceT IO) ())
-&gt; (LambdaState -&gt; IO LambdaState) -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679255652"><span class="annot"><span class="annottext">LambdaState
</span><a href="#local-6989586621679255652"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; (IO ResponsePayload -&gt; IO ())
 -&gt; Maybe (IO ResponsePayload -&gt; IO ()))
-&gt; Int
-&gt; Map Int (IO ResponsePayload -&gt; IO ())
-&gt; (Maybe (IO ResponsePayload -&gt; IO ()),
    Map Int (IO ResponsePayload -&gt; IO ()))
forall k a.
Ord k =&gt;
(k -&gt; a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; (Maybe a, Map k a)
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">M.updateLookupWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IO ResponsePayload -&gt; IO ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ResponsePayload -&gt; IO ())
forall a. Maybe a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679255658"><span class="hs-identifier hs-var">id'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LambdaState -&gt; Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#lsInvocations"><span class="hs-identifier hs-var hs-var">lsInvocations</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaState
</span><a href="#local-6989586621679255652"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-153"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (IO ResponsePayload -&gt; IO ())
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Int (IO ResponsePayload -&gt; IO ())
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LambdaState -&gt; IO LambdaState
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaState
</span><a href="#local-6989586621679255652"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-154"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679255650"><span class="annot"><span class="annottext">IO ResponsePayload -&gt; IO ()
</span><a href="#local-6989586621679255650"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679255649"><span class="annot"><span class="annottext">Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="#local-6989586621679255649"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LambdaState
</span><a href="#local-6989586621679255652"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">lsInvocations :: Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#lsInvocations"><span class="hs-identifier hs-var">lsInvocations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="#local-6989586621679255649"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">LambdaState -&gt; IO () -&gt; IO LambdaState
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">IO ResponsePayload -&gt; IO ()
</span><a href="#local-6989586621679255650"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResponsePayload -&gt; IO ResponsePayload
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ResponsePayload
</span><a href="#local-6989586621679255657"><span class="hs-identifier hs-var">payload</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">{-
https://docs.aws.amazon.com/lambda/latest/dg/dlq.html
-}</span><span>
</span><span id="line-159"></span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#deadLetterThread"><span class="hs-identifier hs-type">deadLetterThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaEnv"><span class="hs-identifier hs-type">LambdaEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span id="deadLetterThread"><span class="annot"><span class="annottext">deadLetterThread :: LambdaEnv -&gt; IO ()
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#deadLetterThread"><span class="hs-identifier hs-var hs-var">deadLetterThread</span></a></span></span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#LambdaEnv"><span class="hs-identifier hs-type">LambdaEnv</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679255644"><span id="local-6989586621679255645"><span id="local-6989586621679255646"><span class="annot"><span class="annottext">Env
MVar LambdaState
StackInfo
leEnv :: Env
leStack :: StackInfo
leState :: MVar LambdaState
leEnv :: LambdaEnv -&gt; Env
leStack :: LambdaEnv -&gt; StackInfo
leState :: LambdaEnv -&gt; MVar LambdaState
</span><a href="#local-6989586621679255644"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-161"></span><span>  </span><span class="annot"><span class="annottext">ResourceT IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadUnliftIO m =&gt; ResourceT m a -&gt; m a
</span><a href="../file:///nix/store/x49rz651v9cgnj874d6smacv0b5w45bn-resourcet-1.2.4-doc/share/doc/resourcet-1.2.4/html/src"><span class="hs-identifier hs-var">runResourceT</span></a></span><span> </span><span class="annot"><span class="annottext">(ResourceT IO () -&gt; IO ())
-&gt; (AWST' Env (ResourceT IO) () -&gt; ResourceT IO ())
-&gt; AWST' Env (ResourceT IO) ()
-&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Env -&gt; AWST' Env (ResourceT IO) () -&gt; ResourceT IO ()
forall (m :: * -&gt; *) r a.
(MonadResource m, HasEnv r) =&gt;
r -&gt; AWS a -&gt; m a
</span><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-var">runAWS</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679255644"><span class="hs-identifier hs-var">leEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(AWST' Env (ResourceT IO) () -&gt; ResourceT IO ())
-&gt; (AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) ()
-&gt; ResourceT IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(AWST' Env (ResourceT IO) () -&gt; IO ())
-&gt; AWST' Env (ResourceT IO) () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-162"></span><span>    </span><span id="local-6989586621679255643"><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679255643"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; AWS [Message]
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#sqsReceiveSome"><span class="hs-identifier hs-var">sqsReceiveSome</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; AWS [Message]) -&gt; Text -&gt; AWS [Message]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">StackInfo -&gt; Text
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Stack.html#siDeadLetterQueue"><span class="hs-identifier hs-var hs-var">siDeadLetterQueue</span></a></span><span> </span><span class="annot"><span class="annottext">StackInfo
</span><a href="#local-6989586621679255645"><span class="hs-identifier hs-var">leStack</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="annot"><span class="annottext">[Message]
-&gt; (Message -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679255643"><span class="hs-identifier hs-var">msgs</span></a></span><span> </span><span class="annot"><span class="annottext">((Message -&gt; AWST' Env (ResourceT IO) ())
 -&gt; AWST' Env (ResourceT IO) ())
-&gt; (Message -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679255641"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255641"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>      </span><span id="local-6989586621679255640"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679255640"><span class="hs-identifier hs-var">id'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; AWST' Env (ResourceT IO) Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; AWST' Env (ResourceT IO) Int)
-&gt; IO Int -&gt; AWST' Env (ResourceT IO) Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Message -&gt; IO Int
</span><a href="#local-6989586621679255639"><span class="hs-identifier hs-var">decodeId</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255641"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-165"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; AWST' Env (ResourceT IO) ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; AWST' Env (ResourceT IO) ())
-&gt; ((LambdaState -&gt; IO LambdaState) -&gt; IO ())
-&gt; (LambdaState -&gt; IO LambdaState)
-&gt; AWST' Env (ResourceT IO) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">MVar LambdaState -&gt; (LambdaState -&gt; IO LambdaState) -&gt; IO ()
forall a. MVar a -&gt; (a -&gt; IO a) -&gt; IO ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">modifyMVar_</span></a></span><span> </span><span class="annot"><span class="annottext">MVar LambdaState
</span><a href="#local-6989586621679255646"><span class="hs-identifier hs-var">leState</span></a></span><span> </span><span class="annot"><span class="annottext">((LambdaState -&gt; IO LambdaState) -&gt; AWST' Env (ResourceT IO) ())
-&gt; (LambdaState -&gt; IO LambdaState) -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679255638"><span class="annot"><span class="annottext">LambdaState
</span><a href="#local-6989586621679255638"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-166"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Int
 -&gt; (IO ResponsePayload -&gt; IO ())
 -&gt; Maybe (IO ResponsePayload -&gt; IO ()))
-&gt; Int
-&gt; Map Int (IO ResponsePayload -&gt; IO ())
-&gt; (Maybe (IO ResponsePayload -&gt; IO ()),
    Map Int (IO ResponsePayload -&gt; IO ()))
forall k a.
Ord k =&gt;
(k -&gt; a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; (Maybe a, Map k a)
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/containers-0.6.2.1/src"><span class="hs-identifier hs-var">M.updateLookupWithKey</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IO ResponsePayload -&gt; IO ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (IO ResponsePayload -&gt; IO ())
forall a. Maybe a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679255640"><span class="hs-identifier hs-var">id'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LambdaState -&gt; Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#lsInvocations"><span class="hs-identifier hs-var hs-var">lsInvocations</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaState
</span><a href="#local-6989586621679255638"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-167"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (IO ResponsePayload -&gt; IO ())
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map Int (IO ResponsePayload -&gt; IO ())
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LambdaState -&gt; IO LambdaState
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaState
</span><a href="#local-6989586621679255638"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-168"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679255637"><span class="annot"><span class="annottext">IO ResponsePayload -&gt; IO ()
</span><a href="#local-6989586621679255637"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679255636"><span class="annot"><span class="annottext">Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="#local-6989586621679255636"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679255635"><span class="annot"><span class="annottext">errMsg :: Maybe Text
</span><a href="#local-6989586621679255635"><span class="hs-identifier hs-var hs-var">errMsg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-170"></span><span>                  </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255641"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-171"></span><span>                    </span><span class="annot"><span class="annottext">Message -&gt; Getting (Maybe Text) Message (Maybe Text) -&gt; Maybe Text
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap Text MessageAttributeValue
 -&gt; Const (Maybe Text) (HashMap Text MessageAttributeValue))
-&gt; Message -&gt; Const (Maybe Text) Message
Lens' Message (HashMap Text MessageAttributeValue)
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">mMessageAttributes</span></a></span><span>
</span><span id="line-172"></span><span>                    </span><span class="annot"><span class="annottext">((HashMap Text MessageAttributeValue
  -&gt; Const (Maybe Text) (HashMap Text MessageAttributeValue))
 -&gt; Message -&gt; Const (Maybe Text) Message)
-&gt; ((Maybe Text -&gt; Const (Maybe Text) (Maybe Text))
    -&gt; HashMap Text MessageAttributeValue
    -&gt; Const (Maybe Text) (HashMap Text MessageAttributeValue))
-&gt; Getting (Maybe Text) Message (Maybe Text)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index (HashMap Text MessageAttributeValue)
-&gt; Lens'
     (HashMap Text MessageAttributeValue)
     (Maybe (IxValue (HashMap Text MessageAttributeValue)))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-identifier hs-var">at</span></a></span><span> </span><span class="annot"><span class="annottext">Index (HashMap Text MessageAttributeValue)
</span><span class="hs-string">&quot;ErrorMessage&quot;</span></span><span>
</span><span id="line-173"></span><span>                    </span><span class="annot"><span class="annottext">((Maybe MessageAttributeValue
  -&gt; Const (Maybe Text) (Maybe MessageAttributeValue))
 -&gt; HashMap Text MessageAttributeValue
 -&gt; Const (Maybe Text) (HashMap Text MessageAttributeValue))
-&gt; ((Maybe Text -&gt; Const (Maybe Text) (Maybe Text))
    -&gt; Maybe MessageAttributeValue
    -&gt; Const (Maybe Text) (Maybe MessageAttributeValue))
-&gt; (Maybe Text -&gt; Const (Maybe Text) (Maybe Text))
-&gt; HashMap Text MessageAttributeValue
-&gt; Const (Maybe Text) (HashMap Text MessageAttributeValue)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(MessageAttributeValue -&gt; Const (Maybe Text) MessageAttributeValue)
-&gt; Maybe MessageAttributeValue
-&gt; Const (Maybe Text) (Maybe MessageAttributeValue)
forall a b. Prism (Maybe a) (Maybe b) a b
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-identifier hs-var">_Just</span></a></span><span>
</span><span id="line-174"></span><span>                    </span><span class="annot"><span class="annottext">((MessageAttributeValue
  -&gt; Const (Maybe Text) MessageAttributeValue)
 -&gt; Maybe MessageAttributeValue
 -&gt; Const (Maybe Text) (Maybe MessageAttributeValue))
-&gt; ((Maybe Text -&gt; Const (Maybe Text) (Maybe Text))
    -&gt; MessageAttributeValue
    -&gt; Const (Maybe Text) MessageAttributeValue)
-&gt; (Maybe Text -&gt; Const (Maybe Text) (Maybe Text))
-&gt; Maybe MessageAttributeValue
-&gt; Const (Maybe Text) (Maybe MessageAttributeValue)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Const (Maybe Text) (Maybe Text))
-&gt; MessageAttributeValue
-&gt; Const (Maybe Text) MessageAttributeValue
Lens' MessageAttributeValue (Maybe Text)
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">mavStringValue</span></a></span><span>
</span><span id="line-175"></span><span>            </span><span class="annot"><span class="annottext">IO ResponsePayload -&gt; IO ()
</span><a href="#local-6989586621679255637"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ResponsePayload -&gt; IO ())
-&gt; (Text -&gt; IO ResponsePayload) -&gt; Text -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InvokeException -&gt; IO ResponsePayload
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(InvokeException -&gt; IO ResponsePayload)
-&gt; (Text -&gt; InvokeException) -&gt; Text -&gt; IO ResponsePayload
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InvokeException
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO ()) -&gt; Text -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-176"></span><span>              </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Lambda function failed: &quot;</span></span><span>
</span><span id="line-177"></span><span>                </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Maybe Text -&gt; Text
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;error message not found.&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679255635"><span class="hs-identifier hs-var">errMsg</span></a></span><span>
</span><span id="line-178"></span><span>            </span><span class="annot"><span class="annottext">LambdaState -&gt; IO LambdaState
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(LambdaState -&gt; IO LambdaState) -&gt; LambdaState -&gt; IO LambdaState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaState
</span><a href="#local-6989586621679255638"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">lsInvocations :: Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#lsInvocations"><span class="hs-identifier hs-var">lsInvocations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map Int (IO ResponsePayload -&gt; IO ())
</span><a href="#local-6989586621679255636"><span class="hs-identifier hs-var">s'</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="#local-6989586621679255639"><span class="hs-identifier hs-type">decodeId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-type">Message</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679255639"><span class="annot"><span class="annottext">decodeId :: Message -&gt; IO Int
</span><a href="#local-6989586621679255639"><span class="hs-identifier hs-var hs-var">decodeId</span></a></span></span><span> </span><span id="local-6989586621679255629"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255629"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255629"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Message
-&gt; Getting (First Scientific) Message Scientific
-&gt; Maybe Scientific
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^?</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Const (First Scientific) (Maybe Text))
-&gt; Message -&gt; Const (First Scientific) Message
Lens' Message (Maybe Text)
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">mBody</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe Text -&gt; Const (First Scientific) (Maybe Text))
 -&gt; Message -&gt; Const (First Scientific) Message)
-&gt; ((Scientific -&gt; Const (First Scientific) Scientific)
    -&gt; Maybe Text -&gt; Const (First Scientific) (Maybe Text))
-&gt; Getting (First Scientific) Message Scientific
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Const (First Scientific) Text)
-&gt; Maybe Text -&gt; Const (First Scientific) (Maybe Text)
forall a b. Prism (Maybe a) (Maybe b) a b
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-identifier hs-var">_Just</span></a></span><span> </span><span class="annot"><span class="annottext">((Text -&gt; Const (First Scientific) Text)
 -&gt; Maybe Text -&gt; Const (First Scientific) (Maybe Text))
-&gt; ((Scientific -&gt; Const (First Scientific) Scientific)
    -&gt; Text -&gt; Const (First Scientific) Text)
-&gt; (Scientific -&gt; Const (First Scientific) Scientific)
-&gt; Maybe Text
-&gt; Const (First Scientific) (Maybe Text)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Traversal' Text Value
forall t. AsValue t =&gt; Text -&gt; Traversal' t Value
</span><a href="../file:///nix/store/fv2iz4n7mhzwgywqyvwfrsvpp0qds3cq-lens-aeson-1.1-doc/share/doc/lens-aeson-1.1/html/src"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;i&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Value -&gt; Const (First Scientific) Value)
 -&gt; Text -&gt; Const (First Scientific) Text)
-&gt; ((Scientific -&gt; Const (First Scientific) Scientific)
    -&gt; Value -&gt; Const (First Scientific) Value)
-&gt; (Scientific -&gt; Const (First Scientific) Scientific)
-&gt; Text
-&gt; Const (First Scientific) Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Scientific -&gt; Const (First Scientific) Scientific)
-&gt; Value -&gt; Const (First Scientific) Value
forall t. AsNumber t =&gt; Prism' t Scientific
</span><a href="../file:///nix/store/fv2iz4n7mhzwgywqyvwfrsvpp0qds3cq-lens-aeson-1.1-doc/share/doc/lens-aeson-1.1/html/src"><span class="hs-identifier hs-var">_Number</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="annottext">Maybe Scientific
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-183"></span><span>        </span><span class="annot"><span class="annottext">InvokeException -&gt; IO Int
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(InvokeException -&gt; IO Int)
-&gt; (Text -&gt; InvokeException) -&gt; Text -&gt; IO Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InvokeException
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; IO Int) -&gt; Text -&gt; IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-184"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Can not find Id: &quot;</span></span><span>
</span><span id="line-185"></span><span>            </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255629"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>      </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679255625"><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679255625"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO Int
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; IO Int) -&gt; Int -&gt; IO Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Scientific -&gt; Int
forall a b. (RealFrac a, Integral b) =&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">truncate</span></a></span><span> </span><span class="annot"><span class="annottext">Scientific
</span><a href="#local-6989586621679255625"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">{-
A helper function to read from SQS queues.
-}</span><span>
</span><span id="line-191"></span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#sqsReceiveSome"><span class="hs-identifier hs-type">sqsReceiveSome</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-type">T.Text</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-type">AWS</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-type">Message</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-192"></span><span id="sqsReceiveSome"><span class="annot"><span class="annottext">sqsReceiveSome :: Text -&gt; AWS [Message]
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#sqsReceiveSome"><span class="hs-identifier hs-var hs-var">sqsReceiveSome</span></a></span></span><span> </span><span id="local-6989586621679255623"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679255623"><span class="hs-identifier hs-var">queue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>  </span><span id="local-6989586621679255622"><span class="annot"><span class="annottext">ReceiveMessageResponse
</span><a href="#local-6989586621679255622"><span class="hs-identifier hs-var">rmrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-194"></span><span>    </span><span class="annot"><span class="annottext">ReceiveMessage -&gt; AWST' Env (ResourceT IO) (Rs ReceiveMessage)
forall (m :: * -&gt; *) a. (MonadAWS m, AWSRequest a) =&gt; a -&gt; m (Rs a)
</span><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">(ReceiveMessage -&gt; AWST' Env (ResourceT IO) (Rs ReceiveMessage))
-&gt; ReceiveMessage -&gt; AWST' Env (ResourceT IO) (Rs ReceiveMessage)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-195"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; ReceiveMessage
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">receiveMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679255623"><span class="hs-identifier hs-var">queue</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="annot"><span class="annottext">ReceiveMessage
-&gt; (ReceiveMessage -&gt; ReceiveMessage) -&gt; ReceiveMessage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Identity (Maybe Int))
-&gt; ReceiveMessage -&gt; Identity ReceiveMessage
Lens' ReceiveMessage (Maybe Int)
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">rmVisibilityTimeout</span></a></span><span>
</span><span id="line-197"></span><span>        </span><span class="annot"><span class="annottext">((Maybe Int -&gt; Identity (Maybe Int))
 -&gt; ReceiveMessage -&gt; Identity ReceiveMessage)
-&gt; Int -&gt; ReceiveMessage -&gt; ReceiveMessage
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">?~</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><span class="annottext">ReceiveMessage
-&gt; (ReceiveMessage -&gt; ReceiveMessage) -&gt; ReceiveMessage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Identity (Maybe Int))
-&gt; ReceiveMessage -&gt; Identity ReceiveMessage
Lens' ReceiveMessage (Maybe Int)
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">rmWaitTimeSeconds</span></a></span><span>
</span><span id="line-199"></span><span>        </span><span class="annot"><span class="annottext">((Maybe Int -&gt; Identity (Maybe Int))
 -&gt; ReceiveMessage -&gt; Identity ReceiveMessage)
-&gt; Int -&gt; ReceiveMessage -&gt; ReceiveMessage
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">?~</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-200"></span><span>        </span><span class="annot"><span class="annottext">ReceiveMessage
-&gt; (ReceiveMessage -&gt; ReceiveMessage) -&gt; ReceiveMessage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Int -&gt; Identity (Maybe Int))
-&gt; ReceiveMessage -&gt; Identity ReceiveMessage
Lens' ReceiveMessage (Maybe Int)
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">rmMaxNumberOfMessages</span></a></span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><span class="annottext">((Maybe Int -&gt; Identity (Maybe Int))
 -&gt; ReceiveMessage -&gt; Identity ReceiveMessage)
-&gt; Int -&gt; ReceiveMessage -&gt; ReceiveMessage
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">?~</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">10</span></span><span>
</span><span id="line-202"></span><span>        </span><span class="annot"><span class="annottext">ReceiveMessage
-&gt; (ReceiveMessage -&gt; ReceiveMessage) -&gt; ReceiveMessage
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Identity [Text])
-&gt; ReceiveMessage -&gt; Identity ReceiveMessage
Lens' ReceiveMessage [Text]
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">rmMessageAttributeNames</span></a></span><span>
</span><span id="line-203"></span><span>        </span><span class="annot"><span class="annottext">(([Text] -&gt; Identity [Text])
 -&gt; ReceiveMessage -&gt; Identity ReceiveMessage)
-&gt; [Text] -&gt; ReceiveMessage -&gt; ReceiveMessage
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;All&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-204"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReceiveMessageResponse
</span><a href="#local-6989586621679255622"><span class="hs-identifier hs-var">rmrs</span></a></span><span> </span><span class="annot"><span class="annottext">ReceiveMessageResponse
-&gt; Getting Int ReceiveMessageResponse Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Int ReceiveMessageResponse Int
Lens' ReceiveMessageResponse Int
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">rmrsResponseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">(AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; AWST' Env (ResourceT IO) ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span>
</span><span id="line-206"></span><span>      </span><span class="annot"><span class="annottext">(IO () -&gt; AWST' Env (ResourceT IO) ())
-&gt; (Text -&gt; IO ()) -&gt; Text -&gt; AWST' Env (ResourceT IO) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InvokeException -&gt; IO ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span>
</span><span id="line-207"></span><span>      </span><span class="annot"><span class="annottext">(InvokeException -&gt; IO ())
-&gt; (Text -&gt; InvokeException) -&gt; Text -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InvokeException
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span class="annot"><span class="annottext">(Text -&gt; AWST' Env (ResourceT IO) ())
-&gt; Text -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error receiving messages: &quot;</span></span><span>
</span><span id="line-209"></span><span>      </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; String) -&gt; Int -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ReceiveMessageResponse
</span><a href="#local-6989586621679255622"><span class="hs-identifier hs-var">rmrs</span></a></span><span> </span><span class="annot"><span class="annottext">ReceiveMessageResponse
-&gt; Getting Int ReceiveMessageResponse Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Int ReceiveMessageResponse Int
Lens' ReceiveMessageResponse Int
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">rmrsResponseStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679255614"><span class="annot"><span class="annottext">msgs :: [Message]
</span><a href="#local-6989586621679255614"><span class="hs-identifier hs-var hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReceiveMessageResponse
</span><a href="#local-6989586621679255622"><span class="hs-identifier hs-var">rmrs</span></a></span><span> </span><span class="annot"><span class="annottext">ReceiveMessageResponse
-&gt; Getting [Message] ReceiveMessageResponse [Message] -&gt; [Message]
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting [Message] ReceiveMessageResponse [Message]
Lens' ReceiveMessageResponse [Message]
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">rmrsMessages</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Message] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679255614"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-212"></span><span>    </span><span id="local-6989586621679255611"><span class="annot"><span class="annottext">DeleteMessageBatchResponse
</span><a href="#local-6989586621679255611"><span class="hs-identifier hs-var">dmbrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-213"></span><span>      </span><span class="annot"><span class="annottext">DeleteMessageBatch
-&gt; AWST' Env (ResourceT IO) (Rs DeleteMessageBatch)
forall (m :: * -&gt; *) a. (MonadAWS m, AWSRequest a) =&gt; a -&gt; m (Rs a)
</span><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">(DeleteMessageBatch
 -&gt; AWST' Env (ResourceT IO) (Rs DeleteMessageBatch))
-&gt; DeleteMessageBatch
-&gt; AWST' Env (ResourceT IO) (Rs DeleteMessageBatch)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; DeleteMessageBatch
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">deleteMessageBatch</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679255623"><span class="hs-identifier hs-var">queue</span></a></span><span>
</span><span id="line-215"></span><span>          </span><span class="annot"><span class="annottext">DeleteMessageBatch
-&gt; (DeleteMessageBatch -&gt; DeleteMessageBatch) -&gt; DeleteMessageBatch
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">([DeleteMessageBatchRequestEntry]
 -&gt; Identity [DeleteMessageBatchRequestEntry])
-&gt; DeleteMessageBatch -&gt; Identity DeleteMessageBatch
Lens' DeleteMessageBatch [DeleteMessageBatchRequestEntry]
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">dmbEntries</span></a></span><span>
</span><span id="line-216"></span><span>          </span><span class="annot"><span class="annottext">(([DeleteMessageBatchRequestEntry]
  -&gt; Identity [DeleteMessageBatchRequestEntry])
 -&gt; DeleteMessageBatch -&gt; Identity DeleteMessageBatch)
-&gt; [DeleteMessageBatchRequestEntry]
-&gt; DeleteMessageBatch
-&gt; DeleteMessageBatch
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">.~</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; DeleteMessageBatchRequestEntry
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">deleteMessageBatchRequestEntry</span></a></span><span>
</span><span id="line-217"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679255607"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; Text
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; Text) -&gt; Maybe Text -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255605"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Message -&gt; Getting (Maybe Text) Message (Maybe Text) -&gt; Maybe Text
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe Text) Message (Maybe Text)
Lens' Message (Maybe Text)
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">mReceiptHandle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679255607"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679255607"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679255605"><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679255605"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Integer] -&gt; [Message] -&gt; [(Integer, Message)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">..</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679255614"><span class="hs-identifier hs-var">msgs</span></a></span><span>
</span><span id="line-220"></span><span>             </span><span class="hs-special">]</span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DeleteMessageBatchResponse
</span><a href="#local-6989586621679255611"><span class="hs-identifier hs-var">dmbrs</span></a></span><span> </span><span class="annot"><span class="annottext">DeleteMessageBatchResponse
-&gt; Getting Int DeleteMessageBatchResponse Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Int DeleteMessageBatchResponse Int
Lens' DeleteMessageBatchResponse Int
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">dmbrsResponseStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">200</span></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>      </span><span class="annot"><span class="annottext">(AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ())
-&gt; AWST' Env (ResourceT IO) () -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; AWST' Env (ResourceT IO) ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span>
</span><span id="line-223"></span><span>        </span><span class="annot"><span class="annottext">(IO () -&gt; AWST' Env (ResourceT IO) ())
-&gt; (Text -&gt; IO ()) -&gt; Text -&gt; AWST' Env (ResourceT IO) ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">InvokeException -&gt; IO ()
forall (m :: * -&gt; *) e a. (MonadThrow m, Exception e) =&gt; e -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">throwIO</span></a></span><span>
</span><span id="line-224"></span><span>        </span><span class="annot"><span class="annottext">(InvokeException -&gt; IO ())
-&gt; (Text -&gt; InvokeException) -&gt; Text -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; InvokeException
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span><span>
</span><span id="line-225"></span><span>      </span><span class="annot"><span class="annottext">(Text -&gt; AWST' Env (ResourceT IO) ())
-&gt; Text -&gt; AWST' Env (ResourceT IO) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Error deleting received messages: &quot;</span></span><span>
</span><span id="line-226"></span><span>        </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-var">T.pack</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; String) -&gt; Int -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ReceiveMessageResponse
</span><a href="#local-6989586621679255622"><span class="hs-identifier hs-var">rmrs</span></a></span><span> </span><span class="annot"><span class="annottext">ReceiveMessageResponse
-&gt; Getting Int ReceiveMessageResponse Int -&gt; Int
forall s a. s -&gt; Getting a s a -&gt; a
</span><a href="../file:///nix/store/10rh5i1rpdfkqiswqgrsrzv661j373vx-lens-4.19.2-doc/share/doc/lens-4.19.2/html/src"><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting Int ReceiveMessageResponse Int
Lens' ReceiveMessageResponse Int
</span><a href="../file:///nix/store/45sycs9p675szgy4kqv5vvi1a7g8k7g0-amazonka-sqs-1.6.1-doc/share/doc/amazonka-sqs-1.6.1/html/src"><span class="hs-identifier hs-var">rmrsResponseStatus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><span class="annottext">[Message] -&gt; AWS [Message]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[Message]
</span><a href="#local-6989586621679255614"><span class="hs-identifier hs-var">msgs</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span id="local-6989586621679255602"><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#withInvoke"><span class="hs-identifier hs-type">withInvoke</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-230"></span><span>  </span><span class="annot"><a href="../file:///nix/store/ysgrjq10g1grnpcjmrk3ka8jwvmxflan-amazonka-1.6.1-doc/share/doc/amazonka-1.6.1/html/src"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-231"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-type">Throttle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-type">Throttle</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-type">Throttle</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Stack.html#StackInfo"><span class="hs-identifier hs-type">StackInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-233"></span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/bytestring-0.10.10.0/src"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/maprj6j9fv4dy49i7q29b8sbhx5r5hs7-distributed-dataset-0.0.1.0-doc/share/doc/distributed-dataset-0.0.1.0/html/src"><span class="hs-identifier hs-type">BackendM</span></a></span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/bytestring-0.10.10.0/src"><span class="hs-identifier hs-type">BS.ByteString</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679255602"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679255602"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-235"></span><span id="withInvoke"><span class="annot"><span class="annottext">withInvoke :: Env
-&gt; (Throttle, Throttle, Throttle)
-&gt; StackInfo
-&gt; ((ByteString -&gt; BackendM ByteString) -&gt; IO a)
-&gt; IO a
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#withInvoke"><span class="hs-identifier hs-var hs-var">withInvoke</span></a></span></span><span> </span><span id="local-6989586621679255601"><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679255601"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621679255600"><span class="annot"><span class="annottext">(Throttle, Throttle, Throttle)
</span><a href="#local-6989586621679255600"><span class="hs-identifier hs-var">throttles</span></a></span></span><span> </span><span id="local-6989586621679255599"><span class="annot"><span class="annottext">StackInfo
</span><a href="#local-6989586621679255599"><span class="hs-identifier hs-var">stack</span></a></span></span><span> </span><span id="local-6989586621679255598"><span class="annot"><span class="annottext">(ByteString -&gt; BackendM ByteString) -&gt; IO a
</span><a href="#local-6989586621679255598"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-236"></span><span>  </span><span id="local-6989586621679255597"><span class="annot"><span class="annottext">LambdaEnv
</span><a href="#local-6989586621679255597"><span class="hs-identifier hs-var">le</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Env -&gt; StackInfo -&gt; IO LambdaEnv
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#newLambdaEnv"><span class="hs-identifier hs-var">newLambdaEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env
</span><a href="#local-6989586621679255601"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">StackInfo
</span><a href="#local-6989586621679255599"><span class="hs-identifier hs-var">stack</span></a></span><span>
</span><span id="line-237"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679255596"><span class="annot"><span class="annottext">answerT :: IO (Async a)
</span><a href="#local-6989586621679255596"><span class="hs-identifier hs-var hs-var">answerT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO (Async a)
forall a. IO a -&gt; IO (Async a)
</span><a href="../file:///nix/store/jx4y2sid3s6533m1kr8bjgv62vanjhjk-async-2.2.2-doc/share/doc/async-2.2.2/html/src"><span class="hs-identifier hs-var">async</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO (Async a)) -&gt; (IO () -&gt; IO a) -&gt; IO () -&gt; IO (Async a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO (Async a)) -&gt; IO () -&gt; IO (Async a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (SomeException -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadCatch m =&gt;
m a -&gt; (SomeException -&gt; m a) -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">catchAny</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LambdaEnv -&gt; IO ()
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#answerThread"><span class="hs-identifier hs-var">answerThread</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaEnv
</span><a href="#local-6989586621679255597"><span class="hs-identifier hs-var">le</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((SomeException -&gt; IO ()) -&gt; IO ())
-&gt; (SomeException -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679255593"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679255593"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">print</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679255593"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-238"></span><span>      </span><span id="local-6989586621679255592"><span class="annot"><span class="annottext">deadLetterT :: IO (Async a)
</span><a href="#local-6989586621679255592"><span class="hs-identifier hs-var hs-var">deadLetterT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO (Async a)
forall a. IO a -&gt; IO (Async a)
</span><a href="../file:///nix/store/jx4y2sid3s6533m1kr8bjgv62vanjhjk-async-2.2.2-doc/share/doc/async-2.2.2/html/src"><span class="hs-identifier hs-var">async</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; IO (Async a)) -&gt; (IO () -&gt; IO a) -&gt; IO () -&gt; IO (Async a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO a
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO (Async a)) -&gt; IO () -&gt; IO (Async a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; (SomeException -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadCatch m =&gt;
m a -&gt; (SomeException -&gt; m a) -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-identifier hs-var">catchAny</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LambdaEnv -&gt; IO ()
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#deadLetterThread"><span class="hs-identifier hs-var">deadLetterThread</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaEnv
</span><a href="#local-6989586621679255597"><span class="hs-identifier hs-var">le</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((SomeException -&gt; IO ()) -&gt; IO ())
-&gt; (SomeException -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679255591"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679255591"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">print</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679255591"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-239"></span><span>  </span><span id="local-6989586621679255590"><span class="annot"><span class="annottext">[Async Any]
</span><a href="#local-6989586621679255590"><span class="hs-identifier hs-var">threads</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Async Any] -&gt; [Async Any] -&gt; [Async Any]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="annot"><span class="annottext">([Async Any] -&gt; [Async Any] -&gt; [Async Any])
-&gt; IO [Async Any] -&gt; IO ([Async Any] -&gt; [Async Any])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO (Async Any) -&gt; IO [Async Any]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">IO (Async Any)
forall a. IO (Async a)
</span><a href="#local-6989586621679255596"><span class="hs-identifier hs-var">answerT</span></a></span><span> </span><span class="annot"><span class="annottext">IO ([Async Any] -&gt; [Async Any]) -&gt; IO [Async Any] -&gt; IO [Async Any]
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO (Async Any) -&gt; IO [Async Any]
forall (m :: * -&gt; *) a. Applicative m =&gt; Int -&gt; m a -&gt; m [a]
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">IO (Async Any)
forall a. IO (Async a)
</span><a href="#local-6989586621679255592"><span class="hs-identifier hs-var">deadLetterT</span></a></span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="annottext">(ByteString -&gt; BackendM ByteString) -&gt; IO a
</span><a href="#local-6989586621679255598"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LambdaEnv
-&gt; (Throttle, Throttle, Throttle)
-&gt; ByteString
-&gt; BackendM ByteString
</span><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#execute"><span class="hs-identifier hs-var">execute</span></a></span><span> </span><span class="annot"><span class="annottext">LambdaEnv
</span><a href="#local-6989586621679255597"><span class="hs-identifier hs-var">le</span></a></span><span> </span><span class="annot"><span class="annottext">(Throttle, Throttle, Throttle)
</span><a href="#local-6989586621679255600"><span class="hs-identifier hs-var">throttles</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; IO () -&gt; IO a
forall (m :: * -&gt; *) a b. MonadMask m =&gt; m a -&gt; m b -&gt; m a
</span><a href="../file:///nix/store/izcyrakv91ykvpja6ivv8rwsk68nc3y8-safe-exceptions-0.1.7.0-doc/share/doc/safe-exceptions-0.1.7.0/html/src"><span class="hs-operator hs-var">`finally`</span></a></span><span> </span><span class="annot"><span class="annottext">(Async Any -&gt; IO ()) -&gt; [Async Any] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">Async Any -&gt; IO ()
forall a. Async a -&gt; IO ()
</span><a href="../file:///nix/store/jx4y2sid3s6533m1kr8bjgv62vanjhjk-async-2.2.2-doc/share/doc/async-2.2.2/html/src"><span class="hs-identifier hs-var">cancel</span></a></span><span> </span><span class="annot"><span class="annottext">[Async Any]
</span><a href="#local-6989586621679255590"><span class="hs-identifier hs-var">threads</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-keyword">newtype</span><span> </span><span id="InvokeException"><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span></span><span>
</span><span id="line-243"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="InvokeException"><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-var">InvokeException</span></a></span></span><span> </span><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/text-1.2.3.2/src"><span class="hs-identifier hs-type">T.Text</span></a></span><span>
</span><span id="line-244"></span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679255580"><span id="local-6989586621679255582"><span id="local-6989586621679255584"><span class="annot"><span class="annottext">Int -&gt; InvokeException -&gt; ShowS
[InvokeException] -&gt; ShowS
InvokeException -&gt; String
(Int -&gt; InvokeException -&gt; ShowS)
-&gt; (InvokeException -&gt; String)
-&gt; ([InvokeException] -&gt; ShowS)
-&gt; Show InvokeException
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [InvokeException] -&gt; ShowS
$cshowList :: [InvokeException] -&gt; ShowS
show :: InvokeException -&gt; String
$cshow :: InvokeException -&gt; String
showsPrec :: Int -&gt; InvokeException -&gt; ShowS
$cshowsPrec :: Int -&gt; InvokeException -&gt; ShowS
</span><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679255571"><span id="local-6989586621679255573"><span id="local-6989586621679255575"><span class="annot"><a href="../file:///nix/store/0z7pkxg8ybr9djlmx845qgjc51n6baha-ghc-8.10.1-doc/share/doc/ghc/html/libraries/base-4.14.0.0/src"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="Control.Distributed.Fork.AWS.Lambda.Internal.Invoke.html#InvokeException"><span class="hs-identifier hs-type">InvokeException</span></a></span></span></span></span><span>
</span><span id="line-247"></span></pre></body></html>